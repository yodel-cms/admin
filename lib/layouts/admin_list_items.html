<%
  heading = nil
  record_heading = nil
%>
<% records.each do |record| %>
  <%
    if group_by
      if record.field(group_by).is_a?(TimeField) || record.field(group_by).is_a?(DateField)
        record_heading = record.send(group_by).to_date
        if record_heading == Date.today
          record_heading = 'Today'
        elsif record_heading == (Date.today - 1)
          record_heading = 'Yesterday'
        else
          record_heading = record_heading.strftime('%a %e %b %Y')
        end
      else
        record_heading = record.send(group_by)
      end
    end
  %>
  <% if heading.nil? || heading != record_heading %>
  <% unless heading.nil? %>
      </ul>
    </li>
  <% else %>
    <% heading = '' %>
  <% end %>
  <li>
    <ul>
  <% end %>
        <% if group_by && heading != record_heading %>
          <h1><%= record_heading %></h1>
          <% heading = record_heading %>
        <% end %>
        <li class="record_row" data-record-id="<%= record.id %>">
          <article>
            <%= site.layouts.where(name: "admin_#{modelling.name.downcase.underscore}_list_item").first.render(record) %>
          </article>
        </li>
<% end %>
  </ul>
</li>
